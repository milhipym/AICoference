<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>로그 학습 시스템</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
      color: #e0e0e0;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      padding: 30px;
      background: rgba(0, 255, 255, 0.05);
      border-radius: 15px;
      border: 2px solid rgba(0, 255, 255, 0.3);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
      position: relative;
    }

    .header h1 {
      font-size: 36px;
      color: #00ffff;
      text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
      margin-bottom: 10px;
      letter-spacing: 3px;
    }

    .header p {
      font-size: 16px;
      color: #00d9ff;
    }

    .back-button {
      position: absolute;
      left: 30px;
      top: 50%;
      transform: translateY(-50%);
      padding: 10px 20px;
      background: linear-gradient(135deg, #00d9ff, #00ffff);
      color: #0a0e27;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
      text-decoration: none;
      display: inline-block;
    }

    .back-button:hover {
      transform: translateY(-50%) scale(1.05);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
    }

    .learning-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .learning-card {
      background: linear-gradient(135deg, rgba(0, 255, 255, 0.08), rgba(0, 217, 255, 0.05));
      border: 2px solid rgba(0, 255, 255, 0.3);
      border-radius: 15px;
      padding: 30px;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .learning-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        45deg,
        transparent,
        rgba(0, 255, 255, 0.1),
        transparent
      );
      transform: rotate(45deg);
      transition: all 0.5s;
    }

    .learning-card:hover::before {
      left: 100%;
    }

    .learning-card:hover {
      transform: translateY(-5px);
      border-color: rgba(0, 255, 255, 0.6);
      box-shadow: 0 10px 40px rgba(0, 255, 255, 0.3);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(0, 255, 255, 0.2);
    }

    .card-number {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #00d9ff, #00ffff);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
      color: #0a0e27;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
    }

    .card-title {
      flex: 1;
    }

    .card-title h3 {
      font-size: 22px;
      color: #00ffff;
      margin-bottom: 5px;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }

    .card-title p {
      font-size: 13px;
      color: #00d9ff;
      opacity: 0.8;
    }

    .card-body {
      margin-bottom: 20px;
    }

    .card-description {
      color: #b0b0b0;
      line-height: 1.6;
      font-size: 14px;
      margin-bottom: 15px;
    }

    .card-features {
      list-style: none;
      padding: 0;
    }

    .card-features li {
      padding: 8px 0;
      padding-left: 25px;
      position: relative;
      color: #d0d0d0;
      font-size: 13px;
    }

    .card-features li::before {
      content: '▸';
      position: absolute;
      left: 0;
      color: #00ffff;
      font-size: 16px;
    }

    .execute-button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #00d9ff, #00ffff);
      color: #0a0e27;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 20px rgba(0, 255, 255, 0.3);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .execute-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(0, 255, 255, 0.5);
    }

    .execute-button:active {
      transform: translateY(0);
    }

    .execute-button:disabled {
      background: rgba(100, 100, 100, 0.5);
      cursor: not-allowed;
      box-shadow: none;
    }

    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
      background: #666;
      animation: pulse 2s ease-in-out infinite;
    }

    .status-indicator.ready {
      background: #00ffff;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }

    .status-indicator.processing {
      background: #ffaa00;
      box-shadow: 0 0 10px rgba(255, 170, 0, 0.5);
    }

    .status-indicator.success {
      background: #00ff88;
      box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
    }

    .status-indicator.error {
      background: #ff6b6b;
      box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .result-panel {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(0, 255, 255, 0.2);
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: #00ff88;
      display: none;
    }

    .result-panel.show {
      display: block;
    }

    .result-panel::-webkit-scrollbar {
      width: 8px;
    }

    .result-panel::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
    }

    .result-panel::-webkit-scrollbar-thumb {
      background: rgba(0, 255, 255, 0.3);
      border-radius: 4px;
    }

    .result-panel::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 255, 255, 0.5);
    }

    .info-panel {
      background: rgba(0, 217, 255, 0.1);
      border: 2px solid rgba(0, 217, 255, 0.3);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .info-panel h4 {
      color: #00ffff;
      margin-bottom: 15px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-panel ul {
      list-style: none;
      padding: 0;
    }

    .info-panel li {
      padding: 8px 0;
      padding-left: 25px;
      position: relative;
      color: #d0d0d0;
      line-height: 1.6;
    }

    .info-panel li::before {
      content: '✓';
      position: absolute;
      left: 0;
      color: #00ff88;
      font-weight: bold;
    }

    @media (max-width: 768px) {
      .learning-grid {
        grid-template-columns: 1fr;
      }

      .back-button {
        position: static;
        transform: none;
        margin-bottom: 20px;
      }

      .header h1 {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <a href="index.html" class="back-button">← 돌아가기</a>
      <h1>◈ LOG LEARNING SYSTEM ◈</h1>
      <p>OpenSearch AI 학습 관리 시스템</p>
    </div>

    <div class="info-panel">
      <h4>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        사용 가이드
      </h4>
      <ul>
        <li>먼저 메인 화면에서 로그 파일을 업로드한 후 이 페이지로 이동하세요</li>
        <li>학습 순서: <strong>1 → 6 → (필요시 2, 3)</strong> 순서로 실행하는 것을 권장합니다</li>
        <li>각 기능은 독립적으로 실행 가능하지만, 인덱스가 먼저 생성되어야 합니다</li>
        <li>학습이 완료된 후 '종합 분석' 페이지에서 월간 추세 분석을 확인할 수 있습니다</li>
      </ul>
    </div>

    <div class="learning-grid">
      <!-- btn_learn_1: 인덱스 생성 -->
      <div class="learning-card">
        <div class="card-header">
          <div class="card-number">1</div>
          <div class="card-title">
            <h3>인덱스 생성</h3>
            <p>OpenSearch Index Initialize</p>
          </div>
        </div>
        <div class="card-body">
          <p class="card-description">
            OpenSearch에 새로운 인덱스를 생성합니다. 
            모든 학습 작업의 기반이 되는 저장소를 만듭니다.
          </p>
          <ul class="card-features">
            <li>인덱스명: contest_pm_task</li>
            <li>벡터 임베딩 필드 설정</li>
            <li>메타데이터 스키마 정의</li>
          </ul>
        </div>
        <button class="execute-button" onclick="executeLearn1()">
          <span class="status-indicator ready"></span>
          인덱스 생성 실행
        </button>
        <div id="result1" class="result-panel"></div>
      </div>

      <!-- btn_learn_2: AI 답변 학습 -->
      <div class="learning-card">
        <div class="card-header">
          <div class="card-number">2</div>
          <div class="card-title">
            <h3>AI 답변 학습</h3>
            <p>AI Response Learning</p>
          </div>
        </div>
        <div class="card-body">
          <p class="card-description">
            업로드된 로그 파일을 AI에게 먼저 분석시킨 후, 
            AI의 답변을 포함하여 학습합니다.
          </p>
          <ul class="card-features">
            <li>vLLM API로 로그 분석 요청</li>
            <li>AI 분석 결과를 메타데이터로 저장</li>
            <li>임베딩과 함께 인덱스에 삽입</li>
          </ul>
        </div>
        <button class="execute-button" onclick="executeLearn2()">
          <span class="status-indicator ready"></span>
          AI 답변 학습 실행
        </button>
        <div id="result2" class="result-panel"></div>
      </div>

      <!-- btn_learn_3: 임베딩 학습 -->
      <div class="learning-card">
        <div class="card-header">
          <div class="card-number">3</div>
          <div class="card-title">
            <h3>임베딩 학습</h3>
            <p>Text Embedding Learning</p>
          </div>
        </div>
        <div class="card-body">
          <p class="card-description">
            업로드된 로그 파일을 청크 단위로 나누어 
            임베딩 벡터를 생성하고 저장합니다.
          </p>
          <ul class="card-features">
            <li>로그 텍스트를 청크로 분할</li>
            <li>/embed API로 벡터 생성</li>
            <li>OpenSearch에 벡터 저장</li>
          </ul>
        </div>
        <button class="execute-button" onclick="executeLearn3()">
          <span class="status-indicator ready"></span>
          임베딩 학습 실행
        </button>
        <div id="result3" class="result-panel"></div>
      </div>

      <!-- btn_learn_4: 학습 데이터 호출 -->
      <div class="learning-card">
        <div class="card-header">
          <div class="card-number">4</div>
          <div class="card-title">
            <h3>학습 데이터 호출</h3>
            <p>Retrieve Learning Data</p>
          </div>
        </div>
        <div class="card-body">
          <p class="card-description">
            OpenSearch에 저장된 학습 데이터를 조회하고 
            검증합니다.
          </p>
          <ul class="card-features">
            <li>인덱스에 저장된 문서 수 확인</li>
            <li>최근 학습 데이터 미리보기</li>
            <li>날짜별 데이터 분포 확인</li>
          </ul>
        </div>
        <button class="execute-button" onclick="executeLearn4()">
          <span class="status-indicator ready"></span>
          데이터 호출 실행
        </button>
        <div id="result4" class="result-panel"></div>
      </div>

      <!-- btn_learn_5: 인덱스 삭제 -->
      <div class="learning-card">
        <div class="card-header">
          <div class="card-number">5</div>
          <div class="card-title">
            <h3>인덱스 삭제</h3>
            <p>Delete Index</p>
          </div>
        </div>
        <div class="card-body">
          <p class="card-description">
            OpenSearch 인덱스를 완전히 삭제합니다. 
            <strong style="color: #ff6b6b;">주의: 모든 데이터가 삭제됩니다!</strong>
          </p>
          <ul class="card-features">
            <li>인덱스 및 모든 데이터 삭제</li>
            <li>재학습 전 초기화 용도</li>
            <li>복구 불가능 - 신중히 사용</li>
          </ul>
        </div>
        <button class="execute-button" onclick="executeLearn5()" style="background: linear-gradient(135deg, #ff6b6b, #ff4444);">
          <span class="status-indicator ready"></span>
          인덱스 삭제 실행
        </button>
        <div id="result5" class="result-panel"></div>
      </div>

      <!-- btn_learn_6: 자체 분석 후 학습 -->
      <div class="learning-card">
        <div class="card-header">
          <div class="card-number">6</div>
          <div class="card-title">
            <h3>자체 분석 후 학습</h3>
            <p>Local Analysis & Learning</p>
          </div>
        </div>
        <div class="card-body">
          <p class="card-description">
            로그 파일을 로컬에서 직접 분석한 후 
            결과를 OpenSearch에 저장합니다. (권장)
          </p>
          <ul class="card-features">
            <li>2-5분 내 빠른 분석 (AI 호출 없음)</li>
            <li>요청 수, 에러, 시간대 등 통계 수집</li>
            <li>월간 추세 분석용 데이터 생성</li>
          </ul>
        </div>
        <button class="execute-button" onclick="executeLearn6()">
          <span class="status-indicator ready"></span>
          자체 분석 학습 실행
        </button>
        <div id="result6" class="result-panel"></div>
      </div>
    </div>
  </div>

  <script>
    // 메인 페이지에서 업로드된 파일 확인
    function checkUploadedFile() {
      // IndexedDB나 localStorage에서 파일 정보 확인
      // 실제 구현은 메인 페이지와 연동 필요
      return true; // 임시로 true 반환
    }

    // 공통 실행 함수
    async function executeTask(taskNumber, taskName, apiFunction) {
      const resultPanel = document.getElementById(`result${taskNumber}`);
      const button = event.target;
      const indicator = button.querySelector('.status-indicator');
      
      // 상태 초기화
      indicator.className = 'status-indicator processing';
      button.disabled = true;
      resultPanel.classList.add('show');
      resultPanel.textContent = `[${new Date().toLocaleTimeString()}] ${taskName} 실행 중...\n`;
      
      try {
        const result = await apiFunction();
        
        // 성공
        indicator.className = 'status-indicator success';
        resultPanel.textContent += `[${new Date().toLocaleTimeString()}] ✓ ${taskName} 완료\n`;
        resultPanel.textContent += JSON.stringify(result, null, 2);
        
        setTimeout(() => {
          indicator.className = 'status-indicator ready';
          button.disabled = false;
        }, 2000);
        
      } catch (error) {
        // 실패
        indicator.className = 'status-indicator error';
        resultPanel.textContent += `[${new Date().toLocaleTimeString()}] ✗ ${taskName} 실패\n`;
        resultPanel.textContent += `에러: ${error.message}\n`;
        
        setTimeout(() => {
          indicator.className = 'status-indicator ready';
          button.disabled = false;
        }, 2000);
      }
    }

    // 학습 기능 1: 인덱스 생성
    async function executeLearn1() {
      await executeTask(1, '인덱스 생성', async () => {
        // TODO: 실제 API 호출 구현
        // window.opener의 함수 호출 또는 직접 API 호출
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({ status: 'success', message: '인덱스가 생성되었습니다.' });
          }, 1000);
        });
      });
    }

    // 학습 기능 2: AI 답변 학습
    async function executeLearn2() {
      await executeTask(2, 'AI 답변 학습', async () => {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({ status: 'success', message: 'AI 답변 학습이 완료되었습니다.' });
          }, 2000);
        });
      });
    }

    // 학습 기능 3: 임베딩 학습
    async function executeLearn3() {
      await executeTask(3, '임베딩 학습', async () => {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({ status: 'success', message: '임베딩 학습이 완료되었습니다.' });
          }, 1500);
        });
      });
    }

    // 학습 기능 4: 학습 데이터 호출
    async function executeLearn4() {
      await executeTask(4, '학습 데이터 호출', async () => {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({ 
              status: 'success', 
              message: '데이터 조회 완료',
              count: 15,
              data: ['2024-10-28', '2024-10-29', '2024-10-30']
            });
          }, 1000);
        });
      });
    }

    // 학습 기능 5: 인덱스 삭제
    async function executeLearn5() {
      if (!confirm('⚠️ 정말로 인덱스를 삭제하시겠습니까?\n모든 학습 데이터가 삭제되며 복구할 수 없습니다!')) {
        return;
      }
      
      await executeTask(5, '인덱스 삭제', async () => {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({ status: 'success', message: '인덱스가 삭제되었습니다.' });
          }, 1000);
        });
      });
    }

    // 학습 기능 6: 자체 분석 후 학습
    async function executeLearn6() {
      await executeTask(6, '자체 분석 후 학습', async () => {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({ 
              status: 'success', 
              message: '로컬 분석 및 학습 완료',
              analyzed: {
                totalRequests: 12543,
                totalErrors: 234,
                date: '2024-10-30'
              }
            });
          }, 3000);
        });
      });
    }

    // 페이지 로드 시
    window.addEventListener('DOMContentLoaded', () => {
      console.log('학습 페이지 로드 완료');
      
      // 파일 업로드 상태 확인
      if (!checkUploadedFile()) {
        alert('먼저 메인 페이지에서 로그 파일을 업로드해주세요.');
      }
    });
  </script>
</body>
</html>
